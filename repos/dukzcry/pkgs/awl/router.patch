patch similar to
https://github.com/mudler/edgevpn/pull/2
diff --git a/config/config.go b/config/config.go
index 14d9ed9..92e01d3 100644
--- a/config/config.go
+++ b/config/config.go
@@ -66,6 +66,7 @@ type (
 	VPNConfig struct {
 		InterfaceName string `json:"interfaceName"`
 		IPNet         string `json:"ipNet"`
+		Router        string `json:"router"`
 	}
 	KnownPeer struct {
 		// Hex-encoded multihash representing a peer ID
diff --git a/service/tunnel.go b/service/tunnel.go
index 81ce29f..40876be 100644
--- a/service/tunnel.go
+++ b/service/tunnel.go
@@ -29,9 +29,12 @@ type Tunnel struct {
 	peersLock    sync.RWMutex
 	peerIDToPeer map[peer.ID]*VpnPeer
 	netIPToPeer  map[string]*VpnPeer
+	network      *net.IPNet
+	router       net.IP
 }
 
 func NewTunnel(p2pService P2p, device *vpn.Device, conf *config.Config) *Tunnel {
+	ip, mask := conf.VPNLocalIPMask()
 	tunnel := &Tunnel{
 		p2p:          p2pService,
 		conf:         conf,
@@ -39,6 +42,8 @@ func NewTunnel(p2pService P2p, device *vpn.Device, conf *config.Config) *Tunnel
 		logger:       log.Logger("awl/service/tunnel"),
 		peerIDToPeer: make(map[peer.ID]*VpnPeer),
 		netIPToPeer:  make(map[string]*VpnPeer),
+		network:      &net.IPNet{IP: ip, Mask: mask},
+		router:       net.ParseIP(conf.VPNConfig.Router).To4(),
 	}
 	tunnel.RefreshPeersList()
 	go tunnel.backgroundReadPackets()
@@ -154,6 +159,9 @@ func (t *Tunnel) backgroundReadPackets() {
 	for packet := range t.device.OutboundChan() {
 		t.peersLock.RLock()
 		vpnPeer, ok := t.netIPToPeer[string(packet.Dst)]
+		if !ok && t.router != nil {
+			vpnPeer, ok = t.netIPToPeer[string(t.router)]
+		}
 		if !ok {
 			t.device.PutTempPacket(packet)
 			t.peersLock.RUnlock()
@@ -280,7 +288,7 @@ func (vp *VpnPeer) backgroundInboundHandler(t *Tunnel) {
 			t.device.PutTempPacket(packet)
 			continue
 		}
-		err := t.device.WritePacket(packet, vp.localIP)
+		err := t.device.WritePacket(packet, vp.localIP, t.network)
 		if err != nil {
 			t.logger.Warnf("write packet to vpn: %v", err)
 		}
diff --git a/vpn/vpn.go b/vpn/vpn.go
index 22a1cea..fc94b36 100644
--- a/vpn/vpn.go
+++ b/vpn/vpn.go
@@ -80,13 +80,18 @@ func (d *Device) PutTempPacket(data *Packet) {
 }
 
 // TODO: batch write
-func (d *Device) WritePacket(data *Packet, senderIP net.IP) error {
+func (d *Device) WritePacket(data *Packet, senderIP net.IP, network *net.IPNet) error {
 	if data.IsIPv6 {
 		// TODO: implement. We need to set Device.localIP ipv6 instead of ipv4
 		return nil
 	} else {
-		copy(data.Src, senderIP)
-		copy(data.Dst, d.localIP)
+		// assumes both peers have the same ipNet definition
+		if network.Contains(data.Src) {
+			copy(data.Src, senderIP)
+		}
+		if network.Contains(data.Dst) {
+			copy(data.Dst, d.localIP)
+		}
 	}
 	data.RecalculateChecksum()
 
