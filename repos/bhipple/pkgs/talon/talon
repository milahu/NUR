#!/usr/bin/env bash
set -euo pipefail

pgrep talon && exit 0

export TERM=xterm-256color
export NIXPKGS_ALLOW_UNFREE=1

channel='https://github.com/NixOS/nixpkgs/archive/3b1b4895b2c5f9f5544d02132896aeb9ceea77bc.tar.gz'  # 2024-06-01 from NixOS release-23.11
pgrep snixembed || snixembed &

mkdir -p /tmp/talon && cd /tmp/talon
nix build -Lvf $channel talon
./result/bin/talon
#nix run -f $channel talon
