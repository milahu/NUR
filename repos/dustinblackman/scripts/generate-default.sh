#!/usr/bin/env bash

set -e

PROGDIR=$(cd "$(dirname "$0")" && pwd)
cd "$PROGDIR"

rm -f ../default.nix

echo "# DO NOT EDIT. This file is auto generated by ./scripts/generate-default.sh
{ pkgs ? import <nixpkgs> { } }:

{
  lib = import ./lib { inherit pkgs; };
  modules = import ./modules;
  overlays = import ./overlays;
"  > ../default.nix


ls ../pkgs | while read f; do
  echo "  $(basename $f .nix) = pkgs.callPackage ./pkgs/$f { };" >> ../default.nix
done

echo "}" >> ../default.nix
