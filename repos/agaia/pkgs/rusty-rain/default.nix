{ lib, fetchFromGitHub, rustPlatform }:

rustPlatform.buildRustPackage rec {
  pname = "rusty-rain";
  version = "v0.3.6";

  src = fetchFromGitHub {
    owner = "cowboy8625";
    repo = pname;
    rev = version;
    hash = "sha256-/DIfVcHvf2OR3JFyac3ztXwWCijEvz+qAXN/SQ5kzFE=";
  };

  # Upstream gitignores the Cargo.lock file, so we need to patch it in for buildRustPackage to work.
  # The lock file was generated by cloning the repo and building
  cargoPatches = [
    ./add-cargo-lock.patch
  ];

  cargoHash = "sha256-/HIvJ3JhGZeLlGcy/Q8z7ZA2kjp8LlChP1RH4pYeMkA=";

  meta = with lib; {
    platforms = platforms.all;
  };
}
