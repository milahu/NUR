name: "Update"
on:
  workflow_dispatch:
  #schedule:
  #  # chosen by fair dice rolling
  #  - cron:  '40 * * * *'
  push:
    branches:
      - master
jobs:
  update_nur:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
      with:
        # TODO what does "depth 0" mean? deep clone?
        #fetch-depth: '0'
        fetch-depth: '1'
    - uses: cachix/install-nix-action@v20
      with:
        #nix_path: nixpkgs=channel:nixos-unstable
        nix_path: nixpkgs=channel:nixpkgs-unstable
        extra_nix_config: |
          experimental-features = nix-command flakes
    - name: update nur / nur-combined
      run: date ; ./ci/update-nur.sh
      env:
        # https://github.com/your_name/NUR/settings/secrets/actions
        API_TOKEN_GITHUB: '${{ secrets.API_TOKEN_GITHUB }}'
        API_USER_GITHUB: '${{ secrets.API_USER_GITHUB }}'
        GRAPHQL_TOKEN_GITHUB: '${{ secrets.GRAPHQL_TOKEN_GITHUB }}'
        FORCE_NUR_SEARCH_UPDATE: '${{ vars.FORCE_NUR_SEARCH_UPDATE }}'
